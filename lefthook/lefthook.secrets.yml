ci-security:
  parallel: false
  commands:
    gitleaks:
      tags: security gotool
      name: gitleaks-scan
      run: gitleaks --exclude-forks --config-path=./.gitleaks.toml --commit=latest --redact --log=error
      # can support sarif format when we have pipeline extension for this enabled.
    # squealer:
    #   tags: security
    #   name: squealer
    #   run: squealer --config-file ./.squealer.yml

pre-push:
  parallel: false
  commands:
    gitleaks:
      tags: security gotool
      name: gitleaks-scan
      run: gitleaks --exclude-forks --config-path=./.gitleaks.toml --commit=latest --redact --log=error

# go install github.com/owenrumney/squealer/cmd/squealer@latest
pre-commit:
  parallel: true
  tags: security
  commands:
    # Install with: go install github.com/owenrumney/squealer/cmd/squealer@latest
    squealer:
      name: squealer
      run: squealer --config-file ./.squealer.yml
    # Install with: go install -v github.com/zricethezav/gitleaks@latest
    gitleaks:
      tags: security gotool
      name: gitleaks-scan
      # run: docker run -v ${PWD}:/repo zricethezav/gitleaks:latest --path="/repo" --pretty -v
      run: gitleaks --pretty --exclude-forks --config=.gitleaks.toml --depth=1 # This expands to past commits --repo-path=
